DROP TABLE if EXISTS members CASCADE;
CREATE TABLE members
(
    id                  BIGINT GENERATED BY DEFAULT AS IDENTITY,
    login_email         VARCHAR(60) NOT NULL UNIQUE,
    login_password      VARCHAR(60) NOT NULL,
    company_name        VARCHAR(60) NOT NULL,
    role                VARCHAR(30) NOT NULL,
    created_date_time   TIMESTAMP NOT NULL,
    primary key (id)
);



DROP TABLE if EXISTS machines CASCADE;
CREATE TABLE machines
(
    id                  BIGINT GENERATED BY DEFAULT AS IDENTITY,
    machine_name        VARCHAR(20) NOT NULL,
    machine_model       VARCHAR(20),
    date_manufactured   DATE,
    sequence            SMALLINT NOT NULL,
    selected            BOOLEAN DEFAULT FALSE NOT NULL ,
    member_id           BIGINT NOT NULL,
    primary key (id),
    FOREIGN KEY (member_id) REFERENCES members(id)
);



DROP TABLE if EXISTS processes CASCADE;
CREATE TABLE processes
(
    id                  BIGINT GENERATED BY DEFAULT AS IDENTITY,
    file_name           VARCHAR(60) NOT NULL,
    thickness           FLOAT,
    started_date_time   TIMESTAMP NOT NULL,
    finished_date_time  TIMESTAMP,
    machine_id          BIGINT NOT NULL,
    primary key (id),
    FOREIGN KEY (machine_id) REFERENCES machines(id) ON UPDATE RESTRICT ON DELETE RESTRICT
);



DROP TABLE if EXISTS logs CASCADE;
CREATE TABLE logs
(
    id                  BIGINT GENERATED BY DEFAULT AS IDENTITY,
    log_name            VARCHAR(60) NOT NULL,
    log_date_time       TIMESTAMP NOT NULL,
    machine_id          BIGINT NOT NULL,
    process_id          BIGINT,
    primary key (id),
    FOREIGN KEY (machine_id) REFERENCES machines(id) ON UPDATE RESTRICT ON DELETE RESTRICT ,
    FOREIGN KEY (process_id) REFERENCES processes(id) ON UPDATE RESTRICT ON DELETE RESTRICT
);


INSERT INTO members VALUES (DEFAULT, 'FBGpx7QTvQ+2vuzMtAvUYT2/UegU7KbhUTlWjnF1xGw=', '$2a$10$o.ELf/cRCuesZ2hWFdAdDOBr0OcZ6oEFD6.JzZyp.JWTM3kDsJYg.', 'tyjf1Z+UA01fHr0ztigw9A==', 'MEMBER', '2024-01-05 13:52:52'),
                           (DEFAULT, 'qdbHE5cw2d2mGv9Zenus4Pv6UM1tW7QsTtyvqDmzKJA=', '$2a$10$u04uFy2x/MiqoJ2OCB/vE.E4AWHYvlKIxMkPGlANZ5g7phvgJ5Ql6', 'tyjf1Z+UA01fHr0ztigw9A==', 'EMAIL_UNAUTHORIZED', '2024-01-04 21:40:11');

INSERT INTO machines VALUES (DEFAULT, '1호기', 'sss', null, 0, DEFAULT, 1);

-- INSERT INTO processes VALUES (DEFAULT, '123.NC', 23.5, '2024-01-10 17:08:05', null, 1);
--
-- INSERT INTO logs VALUES (DEFAULT, '작업 시작', '2024-01-10 17:08:05', 1, 1),
--                         (DEFAULT, 'M코드 정지', '2024-01-10 17:14:21', 1, 1);